<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resident Dashboard</title>
    <link rel="stylesheet" href="css/dashboardstyles.css">
</head>
<body>
    <header class="header">
        <h1>Resident Dashboard</h1>
    </header>

    <main class="dashboard-container">
        <section class="stats">
            <div class="stat-box">
                <h3>Total Reports</h3>
                <p id="totalReports">0</p>
            </div>
            <div class="stat-box">
                <h3>Total Rewards</h3>
                <p id="totalRewards">0</p>
            </div>
            <div class="stat-box">
                <h3>Pending Reports</h3>
                <p id="pendingReports">0</p>
            </div>
        </section>

        <section class="reports">
            <h2>Recent Reports</h2>
            <div id="reportList" class="report-list">
                <p>Loading reports...</p>
            </div>
        </section>
    </main>

    <script src="script.js"></script>
</body>
<script>
    document.addEventListener("DOMContentLoaded", () => {
    const API_URL = "http://localhost:5000/api/v1/residents/get_resident_dashboard";

    // Fetch data from API
    fetch(API_URL)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update stats
                document.getElementById("totalReports").innerText = data.data.totalReports;
                document.getElementById("totalRewards").innerText = data.data.totalRewards;
                document.getElementById("pendingReports").innerText = data.data.pendingReports;

                // Generate reports list
                const reportList = document.getElementById("reportList");
                reportList.innerHTML = ""; // Clear existing content

                data.data.recentReports.forEach(report => {
                    const reportCard = document.createElement("div");
                    reportCard.classList.add("report-card");

                    reportCard.innerHTML = `
                        <img src="${report.photoUrl[0]}" alt="Report Image">
                        <div class="report-info">
                            <h3>${report.userReportedType.toUpperCase()} Waste</h3>
                            <p><strong>Weight:</strong> ${report.approximateWeight} kg</p>
                            <p><strong>ML Identified:</strong> ${report.mlIdentifiedType}</p>
                            <p><strong>Zone:</strong> ${report.assignedZone || "N/A"}</p>
                        </div>
                        <span class="status ${report.status}">${formatStatus(report.status)}</span>
                    `;

                    reportList.appendChild(reportCard);
                });
            } else {
                console.error("Failed to fetch data");
                document.getElementById("reportList").innerHTML = "<p>Error loading reports.</p>";
            }
        })
        .catch(error => {
            console.error("Error fetching data:", error);
            document.getElementById("reportList").innerHTML = "<p>Failed to load reports.</p>";
        });

    // Format status text
    function formatStatus(status) {
        switch (status) {
            case "admin_approved": return "Approved";
            case "collector_assigned": return "Collector Assigned";
            case "useful": return "Useful";
            default: return "Unknown";
        }
    }
});

</script>
</html>
